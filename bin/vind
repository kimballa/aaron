#!/usr/bin/env bash
#
# usage:
# vind <pattern> 
#    .. this will open the file that matches pattern or list the available files.
# vind <pattern> <offset>
#    .. if there are multiple matches, use the <offset>'th one.

if [[ "$1" =~ .*/.* ]]; then
  # Filename contains a path component. Just open it directly if it exists.
  if [ -f "$1" ]; then
    exec vim "$1"
  else
    echo "Error: vind cannot perform searches with a path component ('/' char in filename)"
    echo "Argument was: $1"
    exit 1
  fi
fi

files=`find . -wholename "*/target" -prune -o -type f -name "$1*" -print`
count=`find . -wholename "*/target" -prune -o -type f -name "$1*" -print | wc -l`


offset="$2"

if [ "$count" == "0" ]; then
  echo "No match!"
  exit 1
elif [ "$count" == "1" ]; then
  exec vim "$files"
elif [ ! -z "$offset" ]; then
  # multiple options, but we can choose the offset'th entry
  offset_file=`find . -wholename "*/target" -prune -o -type f -name "$1*" -print \
      | head "-$offset" | tail -1`
  exec vim "$offset_file"
else
  echo "Too many matches:"
  find . -wholename "*/target" -prune -o -type f -name "$1*" -print | cat -n -
  exit 1
fi

